<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" type="device" version="22.0.8">
  <diagram name="Batch + Streaming ELT Architecture">
    <mxGraphModel dx="1440" dy="768" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1920" pageHeight="1080" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Batch Sources -->
        <mxCell id="raw_batch" parent="1" value="ADLS raw (Batch CSV/Parquet)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ddf5df;strokeColor=#2f8f2f;" vertex="1">
          <mxGeometry x="40" y="100" width="240" height="60" as="geometry"/>
        </mxCell>
        <!-- Streaming Producer -->
        <mxCell id="producer" parent="1" value="Python Producer (Event Hub client)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6e6e6;strokeColor=#6b6b6b;" vertex="1">
          <mxGeometry x="40" y="300" width="220" height="60" as="geometry"/>
        </mxCell>

        <!-- Event Hub -->
        <mxCell id="eventhub" parent="1" value="Azure Event Hubs (topic: trips)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ddf5df;strokeColor=#2f8f2f;" vertex="1">
          <mxGeometry x="300" y="300" width="240" height="60" as="geometry"/>
        </mxCell>

        <!-- ADF Batch -->
        <mxCell id="adf_batch" parent="1" value="ADF Batch Orchestrator" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3b0;strokeColor=#b9a100;" vertex="1">
          <mxGeometry x="320" y="100" width="240" height="60" as="geometry"/>
        </mxCell>

        <!-- ASA -->
        <mxCell id="asa" parent="1" value="Azure Stream Analytics (parse + DQ + split)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3b0;strokeColor=#b9a100;" vertex="1">
          <mxGeometry x="580" y="300" width="260" height="60" as="geometry"/>
        </mxCell>

        <!-- ADLS Curated Layers -->
        <mxCell id="curated_batch" parent="1" value="ADLS curated (Batch cleaned CSV)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ddf5df;strokeColor=#2f8f2f;" vertex="1">
          <mxGeometry x="600" y="100" width="260" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="curated_stream" parent="1" value="ADLS streaming-curated (CSV)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ddf5df;strokeColor=#2f8f2f;" vertex="1">
          <mxGeometry x="890" y="260" width="260" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="raw_stream" parent="1" value="ADLS streaming-raw (JSONL)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ddf5df;strokeColor=#2f8f2f;" vertex="1">
          <mxGeometry x="890" y="350" width="260" height="60" as="geometry"/>
        </mxCell>

        <!-- ADF Streaming -->
        <mxCell id="adf_stream" parent="1" value="ADF: pl_streaming_curated_to_stg_core_mdl" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3b0;strokeColor=#b9a100;" vertex="1">
          <mxGeometry x="1190" y="260" width="320" height="60" as="geometry"/>
        </mxCell>

        <!-- Synapse Layers -->
        <mxCell id="stg" parent="1" value="stg.TripsStreaming / stg.TripsBatch" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ddf5df;strokeColor=#2f8f2f;" vertex="1">
          <mxGeometry x="1550" y="180" width="280" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="core" parent="1" value="core.trip_clean &amp; *_slice (merge batch + stream)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ddf5df;strokeColor=#2f8f2f;" vertex="1">
          <mxGeometry x="1880" y="180" width="320" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="mdl" parent="1" value="mdl.fact_trip + dims (unified model)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ddf5df;strokeColor=#2f8f2f;" vertex="1">
          <mxGeometry x="2220" y="180" width="300" height="60" as="geometry"/>
        </mxCell>

        <!-- Power BI -->
        <mxCell id="pbi" parent="1" value="Power BI (vw_fact_trip_bi)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6e6e6;strokeColor=#6b6b6b;" vertex="1">
          <mxGeometry x="2550" y="180" width="240" height="60" as="geometry"/>
        </mxCell>

        <!-- Monitoring -->
        <mxCell id="loganalytics" parent="1" value="Log Analytics (diagnostics)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6e6e6;strokeColor=#6b6b6b;" vertex="1">
          <mxGeometry x="1250" y="400" width="260" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="alerts" parent="1" value="Azure Alerts" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6e6e6;strokeColor=#6b6b6b;" vertex="1">
          <mxGeometry x="1550" y="400" width="180" height="60" as="geometry"/>
        </mxCell>

        <!-- Batch Edges (dashed) -->
        <mxCell id="b1" parent="1" value="Copy" edge="1" source="raw_batch" target="adf_batch" style="endArrow=block;strokeWidth=2;dashed=1;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="b2" parent="1" value="Transform / Clean" edge="1" source="adf_batch" target="curated_batch" style="endArrow=block;strokeWidth=2;dashed=1;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="b3" parent="1" value="Copy → stg" edge="1" source="curated_batch" target="stg" style="endArrow=block;strokeWidth=2;dashed=1;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Streaming Edges (solid) -->
        <mxCell id="s1" parent="1" edge="1" source="producer" target="eventhub" style="endArrow=block;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="s2" parent="1" value="input: inEH" edge="1" source="eventhub" target="asa" style="endArrow=block;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="s3" parent="1" value="outCuratedCsv" edge="1" source="asa" target="curated_stream" style="endArrow=block;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="s4" parent="1" value="outBlob (raw)" edge="1" source="asa" target="raw_stream" style="endArrow=block;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="s5" parent="1" value="Copy CSV → stg" edge="1" source="curated_stream" target="adf_stream" style="endArrow=block;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="s6" parent="1" value="Copy" edge="1" source="adf_stream" target="stg" style="endArrow=block;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="s7" parent="1" value="merge batch + stream" edge="1" source="stg" target="core" style="endArrow=block;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="s8" parent="1" value="upsert dims + fact" edge="1" source="core" target="mdl" style="endArrow=block;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="s9" parent="1" value="view" edge="1" source="mdl" target="pbi" style="endArrow=block;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Monitoring Edges -->
        <mxCell id="m1" parent="1" edge="1" source="asa" target="loganalytics" style="endArrow=open;dashed=1;strokeWidth=1;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="m2" parent="1" edge="1" source="eventhub" target="loganalytics" style="endArrow=open;dashed=1;strokeWidth=1;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="m3" parent="1" edge="1" source="adf_batch" target="alerts" style="endArrow=open;dashed=1;strokeWidth=1;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="m4" parent="1" edge="1" source="adf_stream" target="alerts" style="endArrow=open;dashed=1;strokeWidth=1;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
